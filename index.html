<!DOCTYPE html>
<html lang="en">
<head>
    <title>H2Speed</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!--
        1. HTML
        2. CSS
        3. div.background 1200x800
        4. div.hero 50x50
        5. move left / right (bonus: move up/down)  (bonus: move hero with mouse)
        6. fire 17x47
        7. game loop
        8. div.enemy
        9. enemy objects / enemy movement
        10. collision detection
    -->
    <div id="background">
        <progress id="health" class="progress" value="100" max="100"></progress>
        <progress id="hidroDegree" value="100" max="100"></progress>
        <div id="hero"></div>
        <div id="missiles"></div>
        <div id="hidros"></div>
        <div id="enemies"></div>
        <div id="missiles_enemy"></div>
    </div>
    <div id="gameover"></div>
    <div id="h2logo"></div>
    <div id="sosyalbenlogo"></div>


    <script>
        let health = document.getElementById("health");
        let h2Degree = document.getElementById("hidroDegree");
        var audioLaser  = new Audio();
        var src1  = document.createElement("source");
        src1.type = "audio/mpeg";
        src1.src  = "assets/laser.wav";
        audioLaser.appendChild(src1);

        var audioLaser2  = new Audio();
        var src1  = document.createElement("source");
        src1.type = "audio/mpeg";
        src1.src  = "assets/laser.wav";
        audioLaser2.appendChild(src1);

        var audioLaser3  = new Audio();
        var src1  = document.createElement("source");
        src1.type = "audio/mpeg";
        src1.src  = "assets/laser.wav";
        audioLaser3.appendChild(src1);

        var audioLaser4  = new Audio();
        var src1  = document.createElement("source");
        src1.type = "audio/mpeg";
        src1.src  = "assets/laser.wav";
        audioLaser4.appendChild(src1);

        var audioLaser5  = new Audio();
        var src1  = document.createElement("source");
        src1.type = "audio/mpeg";
        src1.src  = "assets/laser.wav";
        audioLaser5.appendChild(src1);

        var audioExplosion  = new Audio();
        var src2  = document.createElement("source");
        src2.type = "audio/mpeg";
        src2.src  = "assets/explosion.wav";
        audioExplosion.appendChild(src2);

        var audioExplosion2  = new Audio();
        var src3  = document.createElement("source");
        src3.type = "audio/mpeg";
        src3.src  = "assets/explosion.wav";
        audioExplosion2.appendChild(src3);

        var audioExplosion3  = new Audio();
        var src3  = document.createElement("source");
        src3.type = "audio/mpeg";
        src3.src  = "assets/explosion.wav";
        audioExplosion3.appendChild(src3);

        var audioExplosion4  = new Audio();
        var src3  = document.createElement("source");
        src3.type = "audio/mpeg";
        src3.src  = "assets/explosion.wav";
        audioExplosion4.appendChild(src3);

        var audioExplosion5  = new Audio();
        var src3  = document.createElement("source");
        src3.type = "audio/mpeg";
        src3.src  = "assets/explosion.wav";
        audioExplosion5.appendChild(src3);

        var audioSelector = 0;
        var audioSelector_Laser = 0;

        var counter = 0;
        var counter2 = 0;

        var enemySelector=0;

        var hero = {
            left: 375,
            top: 450
        };

        var missiles = [];
        var hidros = [];

        var enemies = [];

        var missiles_enemy = [];

        var isGameOver = false;


        document.onkeydown = function(e) {
            if(!isGameOver){
                if (e.keyCode === 37 || e.keyCode === 65) {
                    // Left
                    if(hero.left>5)
                        hero.left = hero.left - 10;
                }
                if (e.keyCode === 38 || e.keyCode === 87) {
                    // Up
                    if(hero.top > 5)
                        hero.top = hero.top - 10;
                }
                if (e.keyCode === 40 || e.keyCode === 83) {
                    // Down
                    if(hero.top < 450)
                        hero.top = hero.top + 10;
                }
                if (e.keyCode === 39 || e.keyCode === 68) {
                    // Right
                    if(hero.left < 745)
                        hero.left = hero.left + 10;
                }
                if (e.keyCode === 32 || e.keyCode === 13) {
                    // Spacebar (fire)
                    if(audioSelector_Laser%5==0)
                        audioLaser.play();
                    if(audioSelector_Laser%5==1)
                        audioLaser2.play();
                    if(audioSelector_Laser%5==2)
                        audioLaser3.play();
                    if(audioSelector_Laser%5==3)
                        audioLaser4.play();
                    if(audioSelector_Laser%5==4)
                        audioLaser5.play();
                    audioSelector_Laser++; 
                    missiles.push({
                        left: hero.left + 20,
                        top: hero.top - 20
                    });
                    drawMissiles()
                }
                drawHero();
            }
        }


        function drawHero() {
            document.getElementById('hero').style.left = hero.left + 'px';
            document.getElementById('hero').style.top = hero.top + 'px';
        }

        function drawMissiles() {
            document.getElementById('missiles').innerHTML = ""
            for(var i = 0 ; i < missiles.length ; i++ ) {
                document.getElementById('missiles').innerHTML += `<div class='missile1' style='left:${missiles[i].left}px; top:${missiles[i].top}px'></div>`;
            }
        }

        function drawHidros() {
            document.getElementById('hidros').innerHTML = ""
            for(var i = 0 ; i < hidros.length ; i++ ) {
                document.getElementById('hidros').innerHTML += `<div class='hidro1' style='left:${hidros[i].left}px; top:${hidros[i].top}px'></div>`;
            }
        }

        function moveMissiles() {
            for(var i = 0 ; i < missiles.length ; i++ ) {
                missiles[i].top = missiles[i].top - 8
            }
        }

        function moveMissiles_enemy() {
            for(var i = 0 ; i < missiles_enemy.length ; i++ ) {
                missiles_enemy[i].top = missiles_enemy[i].top + 8
            }
        }

        function drawEnemies() {
            document.getElementById('enemies').innerHTML = ""
            for(var i = 0 ; i < enemies.length ; i++ ) {
                
                document.getElementById('enemies').innerHTML += `<div class='enemy' style='left:${enemies[i].left}px; top:${enemies[i].top}px'></div>`;
                
            }
            counter2++;
            if(counter2>20){
                for(var i = 0 ; i < enemies.length ; i++ ) {
                    if(Math.floor(Math.random() * 2)==i)
                        missiles_enemy.push({left: enemies[i].left + 30, top: enemies[i].top + 15}); 
                }
                counter2=0;
            }
        }

        function drawMissiles_enemy() {
            document.getElementById('missiles_enemy').innerHTML = ""
            for(var i = 0 ; i < missiles_enemy.length ; i++ ) {
                document.getElementById('missiles_enemy').innerHTML += `<div class='missile_enemy' style='left:${missiles_enemy[i].left}px; top:${missiles_enemy[i].top}px'></div>`;
            }
        }

        function moveEnemies() {
            for(var i = 0 ; i < enemies.length ; i++ ) {
                enemies[i].top = enemies[i].top + 3;
            }
        }

        function collisionDetection() {
            for (var hidrof = 0; hidrof < hidros.length; hidrof++) {
                if( hero.left + 45>= hidros[hidrof].left  &&
                    hero.left <= hidros[hidrof].left + 5  &&
                    hero.top <= (hidros[hidrof].top) + 20 &&
                    hero.top + 50 >= hidros[hidrof].top){
                        hidros.splice(hidrof, 1);
                        h2Degree.value += 10;
                }

            }
            for (var missile_enemy = 0; missile_enemy < missiles_enemy.length; missile_enemy++) {
                if(missiles_enemy[missile_enemy].top > 470){
                    missiles_enemy.splice(missile_enemy, 1);
                }
                if (
                    missiles_enemy[missile_enemy].left >= hero.left  &&
                    missiles_enemy[missile_enemy].left <= (hero.left + 45)  &&
                    missiles_enemy[missile_enemy].top <= (hero.top + 50)  &&
                    missiles_enemy[missile_enemy].top + 10 >= hero.top
                    ) {
                        missiles_enemy.splice(missile_enemy, 1);
                        health.value -= 10;
                        if(audioSelector%5==0)
                            audioExplosion.play();
                        if(audioSelector%5==1)
                            audioExplosion2.play();
                        if(audioSelector%5==2)
                            audioExplosion3.play();
                        if(audioSelector%5==3)
                            audioExplosion4.play();
                        if(audioSelector%5==4)
                            audioExplosion5.play();
                        audioSelector++;
                }

            }
            for (var enemy = 0; enemy < enemies.length; enemy++) {
                if(enemies[enemy].top > 450){
                        enemies.splice(enemy, 1);
                        health.value -= 20;
                        if(audioSelector%5==0)
                            audioExplosion.play();
                        if(audioSelector%5==1)
                            audioExplosion2.play();
                        if(audioSelector%5==2)
                            audioExplosion3.play();
                        if(audioSelector%5==3)
                            audioExplosion4.play();
                        if(audioSelector%5==4)
                            audioExplosion5.play();
                        audioSelector++;
                }
                if (
                        hero.left + 50 >= enemies[enemy].left  &&
                        hero.left <= (enemies[enemy].left + 60)  &&
                        hero.top <= (enemies[enemy].top + 50)  &&
                        hero.top >= enemies[enemy].top - 50
                    ) {
                        enemies.splice(enemy, 1);
                        health.value -= 30;
                        if(audioSelector%5==0)
                            audioExplosion.play();
                        if(audioSelector%5==1)
                            audioExplosion2.play();
                        if(audioSelector%5==2)
                            audioExplosion3.play();
                        if(audioSelector%5==3)
                            audioExplosion4.play();
                        if(audioSelector%5==4)
                            audioExplosion5.play();
                        audioSelector++;
                    }
                for (var missile = 0; missile < missiles.length; missile++) {
                    if (
                        missiles[missile].left >= enemies[enemy].left  &&
                        missiles[missile].left <= (enemies[enemy].left + 60)  &&
                        missiles[missile].top <= (enemies[enemy].top + 50)  &&
                        missiles[missile].top >= enemies[enemy].top
                    ) {
                        if(Math.floor(Math.random() * 2) == 1){
                            hidros.push({
                                left: enemies[enemy].left + 30,
                                top: enemies[enemy].top + 15
                            });
                        }
                        enemies.splice(enemy, 1);
                        missiles.splice(missile, 1);
                        if(audioSelector%5==0)
                            audioExplosion.play();
                        if(audioSelector%5==1)
                            audioExplosion2.play();
                        if(audioSelector%5==2)
                            audioExplosion3.play();
                        if(audioSelector%5==3)
                            audioExplosion4.play();
                        if(audioSelector%5==4)
                            audioExplosion5.play();
                        audioSelector++;
                    }
                }
            }
            for (var missile = 0; missile < missiles.length; missile++) {
                if(missiles[missile].top < 10)
                        missiles.splice(missile, 1);
            }
            
        }

        function gameLoop() {
            counter++;
            if(counter>50){
                enemies.push({left: Math.floor(Math.random() * 730), top: 0 });
                counter=0;
            }
            drawMissiles_enemy();
            moveMissiles_enemy();
            setTimeout(gameLoop, 50);
            collisionDetection();
            moveMissiles();
            h2Degree.value -= 0.1;
            if(h2Degree.value<=0 || health.value <=0){
                document.getElementById('gameover').style.visibility = "visible";
                isGameOver = true;
            }
            drawMissiles();
            drawHidros();
            moveEnemies();
            drawEnemies();
        }

        gameLoop();

    </script>
</body>
</html>
